<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>1.AGanttJS的基本使用</title>
    <link rel="stylesheet" href="../dist/AGantt.css" />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <h1>
      ⭐️AGanttJS的基本使用
      <a href="https://github.com/liyaxu123/AGantt.js" target="_blank">
        <svg
          t="1727360562648"
          class="icon"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="4255"
          width="36"
          height="36"
        >
          <path
            d="M512 42.666667A464.64 464.64 0 0 0 42.666667 502.186667 460.373333 460.373333 0 0 0 363.52 938.666667c23.466667 4.266667 32-9.813333 32-22.186667v-78.08c-130.56 27.733333-158.293333-61.44-158.293333-61.44a122.026667 122.026667 0 0 0-52.053334-67.413333c-42.666667-28.16 3.413333-27.733333 3.413334-27.733334a98.56 98.56 0 0 1 71.68 47.36 101.12 101.12 0 0 0 136.533333 37.973334 99.413333 99.413333 0 0 1 29.866667-61.44c-104.106667-11.52-213.333333-50.773333-213.333334-226.986667a177.066667 177.066667 0 0 1 47.36-124.16 161.28 161.28 0 0 1 4.693334-121.173333s39.68-12.373333 128 46.933333a455.68 455.68 0 0 1 234.666666 0c89.6-59.306667 128-46.933333 128-46.933333a161.28 161.28 0 0 1 4.693334 121.173333A177.066667 177.066667 0 0 1 810.666667 477.866667c0 176.64-110.08 215.466667-213.333334 226.986666a106.666667 106.666667 0 0 1 32 85.333334v125.866666c0 14.933333 8.533333 26.88 32 22.186667A460.8 460.8 0 0 0 981.333333 502.186667 464.64 464.64 0 0 0 512 42.666667"
            fill="#231F20"
            p-id="4256"
          ></path>
        </svg>
      </a>
    </h1>
    <div class="toolBar">
      <h2>开关配置</h2>
      <ol>
        <li>
          1.
          <code>showViewTypeSwitch</code>
          <span>是否显示视图切换按钮：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          2.
          <code>showBackTodayBtn</code>
          <span>是否显示返回今日快捷按钮：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          3.
          <code>allowTaskbarDrag</code>
          <span>是否允许任务条拖拽移动：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          4.
          <code>allowDelete</code>
          <span>是否允许删除任务条（若工作项上配置了，以工作项为准）：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          5.
          <code>allowTaskbarResize</code>
          <span>是否允许调整任务条的左右宽度：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          6.
          <code>allowTimeTooltip</code>
          <span>是否允许拖拽时展示时间的tooltip：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          7.
          <code>allowAddTaskbar</code>
          <span>是否允许拖拽添加任务条：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
      </ol>
      <h2>主题配置</h2>
      <ol>
        <li>
          1.
          <code>lineColor</code>
          <span>线条颜色：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          2.
          <code>toDayLineColor</code>
          <span>当天日期的线条颜色：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          3.
          <code>weekBarBg</code>
          <span>周末的背景色：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          4.
          <code>rowHeight</code>
          <span>每一行泳道的高度：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
      </ol>
      <h2>事件交互</h2>
      <ol>
        <li>
          1.
          <code>onViewTypeChange</code>
          <span>视图类型发生变化时触发：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          2.
          <code>onTaskBarClick</code>
          <span>任务条被点击时触发：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          3.
          <code>onTimelineClick</code>
          <span>时间轴被点击时触发：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          4.
          <code>onChange</code>
          <span>鼠标拖拽任务条（左右两侧/整条）触发：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          5.
          <code>onDelete</code>
          <span>删除任务条时触发：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          6.
          <code>jumpTo</code>
          <span>跳转到指定日期：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
        <li>
          7.
          <code>setViewType</code>
          <span>切换视图类型：</span>
          <label class="switch">
            <input type="checkbox" />
            <span class="slider"></span>
          </label>
        </li>
      </ol>
    </div>

    <div id="app"></div>
  </body>
  <script src="../dist/AGantt.umd.js"></script>
  <script src="./dayjs.min.js"></script>
  <script>
    function getRandomInt(min, max) {
      min = Math.ceil(min); // 确保最小值是包含的
      max = Math.floor(max); // 确保最大值是包含的
      // 加1是因为区间是开区间
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function randomTime(startYear, endYear) {
      // 生成随机年份
      const randomYear =
        Math.floor(Math.random() * (endYear - startYear + 1)) + startYear;

      // 生成随机月份（0到11，代表1月到12月）
      const randomMonth = Math.floor(Math.random() * 12);

      // 生成随机日期（1到28天，避免月份长度差异带来的复杂性）
      const randomDate = Math.floor(Math.random() * 28) + 1;

      // 生成随机小时（0到23）
      const randomHour = Math.floor(Math.random() * 24);

      // 生成随机分钟（0到59）
      const randomMinute = Math.floor(Math.random() * 60);

      // 生成随机秒（0到59）
      const randomSecond = Math.floor(Math.random() * 60);
      // 使用 dayjs 构建随机时间
      return dayjs()
        .year(randomYear)
        .month(randomMonth)
        .date(randomDate)
        .hour(randomHour)
        .minute(randomMinute)
        .second(randomSecond);
    }

    function getBarList() {
      // 状态
      const status = ["success", "warning", "error", "default"];
      // 优先级
      const priority = ["高", "中", "低"];
      const arr = [];
      for (let i = 0; i < 200; i++) {
        const start = randomTime(2024, 2025);

        arr.push({
          id: i + 1,
          title: `任务${i + 1}`,
          startDate: start.format("YYYY-MM-DD"),
          endDate: dayjs(
            start + 1000 * 60 * 60 * 24 * getRandomInt(0, 20)
          ).format("YYYY-MM-DD"),
          status: status[getRandomInt(0, 3)],
          priority: priority[getRandomInt(0, 2)],
          progress: getRandomInt(0, 100) / 100,
        });
      }
      return arr;
    }

    const tasks = getBarList();
    console.log(tasks);

    const bgColor = {
      success: "#52c41a",
      warning: "#faad14",
      error: "#f5222d",
      default: "#bfbfbf",
    };

    const priorityIcon = {
      高: '<svg t="1727676116906" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5944" width="200" height="200"><path d="M790.3 385H591.2l128.4-276.1c6.4-19.3-12.8-45-32.1-45H430.7c-12.8 0-25.7 6.4-32.1 19.3L205.9 596.9c-6.4 25.7 12.8 44.9 32.1 44.9h224.8l-64.2 289v6.4c0 12.8 12.8 25.7 25.7 25.7 6.4 0 19.3-6.4 19.3-12.8L816 436.3c12.8-25.7 0-51.3-25.7-51.3z m0 0" fill="#ff0000" p-id="5945"></path></svg>',
      中: '<svg t="1727674660619" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5415" width="200" height="200"><path d="M790.3 385H591.2l128.4-276.1c6.4-19.3-12.8-45-32.1-45H430.7c-12.8 0-25.7 6.4-32.1 19.3L205.9 596.9c-6.4 25.7 12.8 44.9 32.1 44.9h224.8l-64.2 289v6.4c0 12.8 12.8 25.7 25.7 25.7 6.4 0 19.3-6.4 19.3-12.8L816 436.3c12.8-25.7 0-51.3-25.7-51.3z m0 0" fill="#fcf352" p-id="5416"></path></svg>',
      低: '<svg t="1727674646996" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5259" width="200" height="200"><path d="M790.3 385H591.2l128.4-276.1c6.4-19.3-12.8-45-32.1-45H430.7c-12.8 0-25.7 6.4-32.1 19.3L205.9 596.9c-6.4 25.7 12.8 44.9 32.1 44.9h224.8l-64.2 289v6.4c0 12.8 12.8 25.7 25.7 25.7 6.4 0 19.3-6.4 19.3-12.8L816 436.3c12.8-25.7 0-51.3-25.7-51.3z m0 0" fill="#1cd3ec" p-id="5260"></path></svg>',
    };

    const gantt = new AGantt("#app", tasks, {
      viewType: "day", // 视图类型：quarter
      showViewTypeSwitch: true, // 是否显示视图切换按钮
      showBackToday: true, // 是否显示返回今日按钮
      lineColor: "#f0f0f0", // 线条颜色
      curDayLineColor: "#1890ff", // 当天日期的线条颜色
      weekBarBg: "#fafbfd", // 周末条的背景色
      onViewTypeChange: (viewType) => {
        console.log(viewType);
      },
      // 点击任务条时触发
      onTaskBarClick: (taskData) => {
        alert(taskData.title);
      },
      // 点击时间轴时触发
      onTimelineClick: (data) => {
        alert(data);
      },
      // 是否显示拖拽时的遮罩层
      showDragMask: true,
      // 是否显示tooltip
      showTooltip: true,
      // 自定义tooltip，当 showTooltip 为 true 时，生效
      renderTooltip: (taskData) => {
        const status = {
          success: "已完成",
          warning: "未完成",
          error: "已超期",
          default: "进行中",
        };

        return `
    <div style="
      min-width: 200px;
      padding: 8px; 
      line-height: 30px; 
      background-color: #fff; 
      border: 1px solid #eee; 
      border-radius: 4px; 
      margin-top: 4px; 
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,.15);"
    >
      <div>任务名称：${taskData.title}</div>
      <div>开始时间：${taskData.startDate}</div>
      <div>结束时间：${taskData.endDate}</div>
      <div>完成进度：${Math.round(taskData.progress * 100)}%</div>
      <div>状态：
        <span style="background: ${
          bgColor[taskData.status]
        }; border-radius: 4px; padding: 2px 8px; color: #fff;">
          ${status[taskData.status]}
        </span>
      </div>
      <div style="display: flex; align-items: center;">优先级：
        <span style="
        width: 20px;
        height: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 4px;
        ">
          ${priorityIcon[taskData.priority]}
        </span>
        ${taskData.priority}
      </div>
    </div>
    `;
      },
      // 自定义taskbar的内容
      renderTaskbarContent: (taskData) => {
        return `
    <div style="
      width: 100%;
      height: 100%;
      padding: 0 10px;
      background-color: ${bgColor[taskData.status]};
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,.15);
      cursor: pointer;
      display: flex;
      align-items: center;
      color: #fff;
      font-size: 14px;
      overflow: visible;
      white-space: nowrap;
    ">
      <span style="
        width: 20px;
        height: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 4px;
      ">
        ${priorityIcon[taskData.priority]}
      </span>
      ${taskData.title}
    </div>
    `;
      },
    });
  </script>
</html>
